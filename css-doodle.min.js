!function(a,b){typeof exports==='object'&&typeof module!=='undefined'?b():typeof define==='function'&&define.amd?define(b):(b())}(this,(function(){'use strict';let a={even:a=>!!(a%2),odd:a=>!(a%2)};function b(a,b,c){return a=>a==c}function d(a,b){return(c,d)=>a==c&&b==d}function f(b){return c=>/^(even|odd)$/.test(c)?a[c](b):c==b}function g(b,c){return b=>/^(even|odd)$/.test(b)?a[b](c):b==c}function h(b,c,d){return b=>a.even(d)}function i(b,c,d){return b=>a.odd(d)}var j=Object.freeze({nth:b,at:d,row:f,col:g,even:h,odd:i});function k(a,b,c){return a=>c}function l(a){return b=>a}function m(a,b){return a=>b}function o(){return function(...a){return q.apply(null,a)}}function p(){return function(...a){return q(r(t(s)).apply(null,a))}}function q(...a){let b=a.reduce((a,b)=>a.concat(b),[]);return b[Math.floor(Math.random()*b.length)]}function r(a){return function(...b){let c={},d=b.join('-');if(c[d])return c[d];return c[d]=a.apply(null,b)}}function s(a,b,c){let d=0,e=a=>a>0&&a<1?.1:1,f=arguments.length;f==1&&([a,b]=[e(a),a]);f<3&&(c=e(b));let g=[];while(c>0&&a<b||c<0&&a>b){g.push(a);a+=c;if(d++>=1000)break}return g}function t(a){return function(...b){let c=v(b[0]);if(c){b=b.map(w);return u(a,c).apply(null,b)}return a.apply(null,b)}}function u(a,b){return function(...c){c=c.map(w);let d=a.apply(null,c);b&&(d=d.map(a=>a+b));return d}}function v(a){if(!a)return'';let b=/(%|cm|em|ex|in|mm|pc|pt|px|vh|vw|vmin|deg|ms|s)$/,c=''.trim.call(a).match(b);return c?c[0]:''}function w(a){let b=v(a);return b?+(a.replace(b,'')):a}var z=Object.freeze({index:k,row:l,col:m,any:o,rand:p});function A(a){if(Array.isArray(a))return a;return Object.keys(a).map(b=>a[b])}function B(a,...b){return b.reduce((a,b)=>a.apply(null,A(b)),a)}function C(a){return(a||[]).join('\n')}function D(a){return Array.isArray(a)?a:[a]}function E(a,b,c){return Math.max(b,Math.min(c,a))}class F{constructor(a){this.tokens=a;this.rules={};this.props={};this.styles={host:'',cells:''}}add_rule(a,b){let c=this.rules[a];c||(c=this.rules[a]=[]);c.push.apply(c,D(b))}compose_selector(a,b = ''){return`.cell:nth-of-type(${a}) .shape${b}`}compose_value(a,b){return a.reduce((a,c)=>{switch(c.type){case 'text':{a+=c.value;break};case 'function':{let d=z[c.name.substr(1)];d&&(a+=B(d,b,c.arguments))}};return a},'')}compose_rule(a,b){let c=a.property,d=this.compose_value(a.value,b);c=='transition'&&(this.props.has_transition=!0);return`${c}: ${d};`}compose(a,b){(b||this.tokens).forEach((b,c)=>{if(b.skip)return !1;switch(b.type){case 'rule':this.add_rule(this.compose_selector(a.count),this.compose_rule(b,a));break;case 'psudo':{b.selector.startsWith(':doodle')&&(b.selector=b.selector.replace(/^\:+doodle/,':host'));let c=b.selector.startsWith(':host');c&&(b.skip=!0);let d=b.styles.map(b=>this.compose_rule(b,a)),e=c?b.selector:this.compose_selector(a.count,b.selector);this.add_rule(e,d);break};case 'cond':let d=j[b.name.substr(1)];if(d){let c=B(d,a,b.arguments);c&&this.compose(a,b.styles)};break}})}output(){Object.keys(this.rules).forEach(a=>{let b=a.startsWith(':host'),c=b?'host':'cells';this.styles[c]+=`${a} {${C(this.rules[a])}}`});return{props:this.props,styles:this.styles}}}function G(a,b){let c=new F(a);for(let a=1,d=0;a<=b.x;++a){for(let e=1;e<=b.y;++e)c.compose({x:a,y:e,count:++d})}return c.output()}let H={func:()=>({type:'function',name:'',arguments:[]}),text:()=>({type:'text',value:''}),psudo:()=>({type:'psudo',selector:'',styles:[]}),cond:()=>({type:'cond',name:'',styles:[],arguments:[]}),rule:()=>({type:'rule',property:'',value:[]}),comment:()=>({type:'comment',value:''})},I={'(':')','[':']','{':'}'},J={white_space(a){return /[\s\n\t]/.test(a)},open_bracket(a){return I.hasOwnProperty(a)},close_bracket_of(a){let b=I[a];return a=>a==b},number(a){return!isNaN(a)}};function K(a){let b=0,c=1,d=1;return{curr:(c = 0)=>a[b+c],end:()=>a.length<=b,info:()=>({index:b,col:c,line:d}),next:()=>{let e=a[b++];e=='\n'?(d++, c=0):c++;return e}}}function L(a,{col:b,line:c}){throw new Error(`(at line ${c}, column ${b}) ${a}`)}function M(a){let[b,c]=[a.curr(),a.curr()],d=J.close_bracket_of(c);a.next();while(!a.end()){if(d(c=a.curr())){b+=c;break}else J.open_bracket(c)?(b+=M(a)):(b+=c);a.next()}return b}function N(a,b = {}){let c=H.comment(),d=a.curr();d!='#'&&a.next();a.next();while(!a.end()){if((d=a.curr())=='*'&&a.curr(1)=='/')break;else c.value+=d;d=a.curr();if(b.inline){if(d=='\n')return c}else{if(d=='*'&&a.curr(1)=='/')break}c.value+=d;a.next()}a.next();a.next();return c}function O(a){let b='',c;while(!a.end()){if((c=a.curr())==':')break;else /[a-zA-Z\-]/.test(c)?J.white_space(c)||(b+=c):L('Syntax error: Bad property name.',a.info());a.next()}return b}function P(a,b){let c='',d;a.next();while(!a.end()){if((d=a.curr())==b){if(a.curr(-1)!=='\\')break;else c+=d}else c+=d;a.next()}return c}function Q(a){let b=[],c='',d;while(!a.end()){if(J.open_bracket(d=a.curr()))c+=M(a);else if(/['"]/.test(d))c+=P(a,d);else if(/[,)]/.test(d)){c.length&&(b.push(J.number(+c)?+c:c),c='');if(d==')')break}else J.white_space(d)||(c+=d);a.next()}return b}function R(a){let b=H.func(),c='',d;while(!a.end()){if((d=a.curr())==')')break;if(d=='('){a.next();b.name=c;b.arguments=Q(a);break}else c+=d;a.next()}return b}function S(a){let b=H.text(),c,d=[];while(!a.end()){if((c=a.curr())=='\n'){a.next();continue}else if(/[;}]/.test(c)){b.value.length&&d.push(b);b=H.text();break}else c=='@'?(b.value.length&&d.push(b),b=H.text(),d.push(R(a))):(!J.white_space(c)||!J.white_space(a.curr(-1)))&&(c==':'&&L('Syntax error: Bad property name.',a.info()),b.value+=c);a.next()}b.value.length&&d.push(b);return d}function T(a){let b='',c;while(!a.end()){if((c=a.curr())=='{')break;else J.white_space(c)||(b+=c);a.next()}return b}function U(a){let b={name:'',arguments:[]},c;while(!a.end()){if((c=a.curr())=='(')a.next(),b.arguments=Q(a);else if(/[){]/.test(c))break;else J.white_space(c)||(b.name+=c);a.next()}return b}function V(a){let b=H.psudo(),c;while(!a.end()){if((c=a.curr())=='}')break;if(J.white_space(c)){a.next();continue}else b.selector?b.styles.push(W(a)):(b.selector=T(a));a.next()}return b}function W(a){let b=H.rule(),c;while(!a.end()){if((c=a.curr())==';')break;else if(!b.property.length)b.property=O(a);else{b.value=S(a);break};a.next()}return b}function X(a){let b=H.cond(),c;while(!a.end()){if((c=a.curr())=='}')break;else if(!b.name.length)Object.assign(b,U(a));else if(c==':'){let c=V(a);c.selector&&b.styles.push(c)}else if(c=='@')b.styles.push(X(a));else if(!J.white_space(c)){let c=W(a);c.property&&b.styles.push(c)};a.next()}return b}function Y(a){let b=K(a),c=[];while(!b.end()){let a=b.curr();if(J.white_space(a)){b.next();continue}else if(a=='/'&&b.curr(1)=='*')c.push(N(b));else if(a=='#'||a=='/'&&b.curr(1)=='/')c.push(N(b,{inline:!0}));else if(a==':'){let a=V(b);a.selector&&c.push(a)}else if(a=='@'){let a=X(b);a.name.length&&c.push(a)}else if(!J.white_space(a)){let a=W(b);a.property&&c.push(a)};b.next()}return c}function Z(a,b){return G(Y(a),b)}function _(a){let b=(a+'').replace(/\s+/g,'').replace(/[,ï¼ŒxX]+/,'x').split('x'),c={x:E(parseInt(b[0],10),1,16),y:E(parseInt(b[1]||b[0]),1,16)};return{x:c.x,y:c.y,count:c.x*c.y}}class $ extends HTMLElement{constructor(){super();this.doodle=this.attachShadow({mode:'open'});this.basic_styles="\n:host {\ndisplay: inline-block !important;\nwidth: 1em;\nheight: 1em;\nwill-change: transform;\n}\n.container {\nposition: relative;\nwidth: 100%;\nheight: 100%;\n}\n.container:after {\ncontent: '';\ndisplay: block;\nclear: both;\nvisibility: hidden;\n}\n.cell {\nposition: relative;\nfloat: left;\nline-height: 0;\nbox-sizing: border-box;\n}\n.shape {\nbox-sizing: border-box;\nline-height: 0;\nposition: absolute;\nwidth: 100%;\nheight: 100%;\ntransform-origin: center center;\nz-index: 1;\ndisplay: flex;\nalign-items: center;\njustify-content: center;\n}\n"}connectedCallback(){let a;this.size=_(this.getAttribute('grid')||'1x1');if(!this.innerHTML.trim())return !1;try{a=Z(this.innerHTML,this.size)}catch(a){this.innerHTML='';throw new Error(a)};let{has_transition:b}=a.props;this.doodle.innerHTML=`<style>${this.basic_styles}</style><style class="style-container">${this.style_size()}${a.styles.host}</style><style class="style-cells">${b?'':a.styles.cells}</style><div class="container">${this.html_cells()}</div>`;b&&setTimeout(()=>{this.set_style('.style-cells',a.styles.cells)},50)}style_size(){return`.cell {width: ${100/this.size.x+'%'};height: ${100/this.size.y+'%'};}`}html_cells(){let a="\n<div class=\"cell\">\n<div class=\"shape\"></div>\n</div>\n";return a.repeat(this.size.count)}set_style(a,b){let c=this.shadowRoot.querySelector(a);c&&(c.styleSheet?(c.styleSheet.cssText=b):(c.innerHTML=b))}update(a){if(!a)return !1;let b=Z(a,this.size);this.set_style('.style-container',this.style_size()+b.styles.host);this.set_style('.style-cells',b.styles.cells);this.innerHTML=a}refresh(){this.update(this.innerHTML)}get grid(){return Object.assign({},this.size)}set grid(a){this.setAttribute('grid',a);this.connectedCallback()}static get observedAttributes(){return['grid']}attributeChangedCallback(a,b,c){a=='grid'&&b&&(b!==c&&(this.grid=c))}}customElements.define('css-doodle',$)}))