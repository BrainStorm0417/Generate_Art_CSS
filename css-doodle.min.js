!function(e,t){typeof exports==='object'&&typeof module!=='undefined'?t():typeof define==='function'&&define.amd?define(t):(t())}(this,(function(){"use strict";let e={even:e=>!!(e%2),odd:e=>!(e%2)};function t(e,t,n){return e=>e==n}function n(e,t){return(n,r)=>e==n&&t==r}function r(t){return n=>/^(even|odd)$/.test(n)?e[n](t):n==t}function u(t,n){return t=>/^(even|odd)$/.test(t)?e[t](n):t==n}function s(t,n,r){return t=>e.even(r)}function c(t,n,r){return t=>e.odd(r)}var o=Object.freeze({nth:t,at:n,row:r,col:u,even:s,odd:c});function l(e,t,n){return e=>n}function i(e){return t=>e}function a(e,t){return e=>t}function p(){return function(...e){return h.apply(null,e)}}function f(){return function(...e){return h(d(m(y)).apply(null,e))}}function h(...e){let t=e.reduce((e,t)=>e.concat(t),[]);return t[Math.floor(Math.random()*t.length)]}function d(e){return function(...t){let n={},r=t.join('-');if(n[r])return n[r];return n[r]=e.apply(null,t)}}function y(e,t,n){let r=0,u=e=>e>0&&e<1?.1:1,s=arguments.length;s==1&&([e,t]=[u(e),e]);s<3&&(n=u(t));let c=[];while(n>0&&e<t||n<0&&e>t){c.push(e);e+=n;if(r++>=1e3)break}return c}function m(e){return function(...t){let n=_(t[0]);if(n){t=t.map(w);return x(e,n).apply(null,t)}return e.apply(null,t)}}function x(e,t){return function(...n){n=n.map(w);let r=e.apply(null,n);t&&(r=r.map(e=>e+t));return r}}function _(e){if(!e)return'';let t=/(%|cm|em|ex|in|mm|pc|pt|px|vh|vw|vmin|deg|ms|s)$/,n=''.trim.call(e).match(t);return n?n[0]:''}function w(e){let t=_(e);return t?+(e.replace(t,'')):e}var g=Object.freeze({index:l,row:i,col:a,any:p,rand:f});function b(e){if(Array.isArray(e))return e;return Object.keys(e).map(t=>e[t])}function z(e,...t){return t.reduce((e,t)=>e.apply(null,b(t)),e)}function v(e){return(e||[]).join('\n')}function k(e){return Array.isArray(e)?e:[e]}function T(e,t,n){return Math.max(t,Math.min(n,e))}class H{constructor(e){this.tokens=e;this.rules={};this.props={};this.styles={host:'',cells:''}}add_rule(e,t){let n=this.rules[e];n||(n=this.rules[e]=[]);n.push.apply(n,k(t))}compose_selector(e,t = ''){return`.cell:nth-of-type(${e}) .shape${t}`}compose_value(e,t){return e.reduce((e,n)=>{switch(n.type){case 'text':{e+=n.value;break};case 'function':{let r=g[n.name.substr(1)];r&&(e+=z(r,t,n.arguments))}}return e},'')}compose_rule(e,t){let n=e.property,r=this.compose_value(e.value,t);n=='transition'&&(this.props.has_transition=!0);return`${n}: ${r};`}compose(e,t){(t||this.tokens).forEach((t,n)=>{if(t.skip)return!1;switch(t.type){case 'rule':this.add_rule(this.compose_selector(e.count),this.compose_rule(t,e));break;case 'psudo':{t.selector.startsWith(':doodle')&&(t.selector=t.selector.replace(/^\:+doodle/,':host'));let n=t.selector.startsWith(':host');n&&(t.skip=!0);let r=t.styles.map(t=>this.compose_rule(t,e)),u=n?t.selector:this.compose_selector(e.count,t.selector);this.add_rule(u,r);break};case 'cond':let r=o[t.name.substr(1)];if(r){let n=z(r,e,t.arguments);n&&this.compose(e,t.styles)};break}})}output(){Object.keys(this.rules).forEach(e=>{let t=e.startsWith(':host'),n=t?'host':'cells';this.styles[n]+=`${e} {${v(this.rules[e])}}`});return{props:this.props,styles:this.styles}}}function L(e,t){let n=new H(e);for(let e=1,r=0;e<=t.x;++e){for(let u=1;u<=t.y;++u)n.compose({x:e,y:u,count:++r})}return n.output()}let M={func:()=>({type:'function',name:'',arguments:[]}),text:()=>({type:'text',value:''}),psudo:()=>({type:'psudo',selector:'',styles:[]}),cond:()=>({type:'cond',name:'',styles:[],arguments:[]}),rule:()=>({type:'rule',property:'',value:[]}),comment:()=>({type:'comment',value:''})},S={'(':')','[':']','{':'}'},A={white_space(e){return /[\s\n\t]/.test(e)},open_bracket(e){return S.hasOwnProperty(e)},close_bracket_of(e){let t=S[e];return e=>e==t},number(e){return!isNaN(e)}};function W(e){let t=0,n=1,r=1;return{curr:(n = 0)=>e[t+n],end:()=>e.length<=t,info:()=>({index:t,col:n,line:r}),next:()=>{let u=e[t++];u=='\n'?(r++, n=0):n++;return u}}}function j(e,{col:t,line:n}){throw new Error(`(at line ${n}, column ${t}) ${e}`)}function C(e){let[t,n]=[e.curr(),e.curr()],r=A.close_bracket_of(n);e.next();while(!e.end()){if(r(n=e.curr())){t+=n;break}else A.open_bracket(n)?(t+=C(e)):(t+=n);e.next()}return t}function q(e,t = {}){let n=M.comment(),r=e.curr();r!='#'&&e.next();e.next();while(!e.end()){if((r=e.curr())=='*'&&e.curr(1)=='/')break;else n.value+=r;r=e.curr();if(t.inline){if(r=='\n')return n}else{if(r=='*'&&e.curr(1)=='/')break}n.value+=r;e.next()}e.next();e.next();return n}function B(e){let t='',n;while(!e.end()){if((n=e.curr())==':')break;else /[a-zA-Z\-]/.test(n)?A.white_space(n)||(t+=n):j('Syntax error: Bad property name.',e.info());e.next()}return t}function E(e,t){let n='',r;e.next();while(!e.end()){if((r=e.curr())==t){if(e.curr(-1)!=='\\')break;else n+=r}else n+=r;e.next()}return n}function O(e){let t=[],n='',r;while(!e.end()){if(A.open_bracket(r=e.curr()))n+=C(e);else if(/['"]/.test(r))n+=E(e,r);else if(/[,)]/.test(r)){n.length&&(t.push(A.number(+n)?+n:n),n='');if(r==')')break}else A.white_space(r)||(n+=r);e.next()}return t}function P(e){let t=M.func(),n='',r;while(!e.end()){if((r=e.curr())==')')break;if(r=='('){e.next();t.name=n;t.arguments=O(e);break}else n+=r;e.next()}return t}function R(e){let t=M.text(),n,r=[];while(!e.end()){if((n=e.curr())=='\n'){e.next();continue}else if(/[;}]/.test(n)){t.value.length&&r.push(t);t=M.text();break}else n=='@'?(t.value.length&&r.push(t),t=M.text(),r.push(P(e))):(!A.white_space(n)||!A.white_space(e.curr(-1)))&&(n==':'&&j('Syntax error: Bad property name.',e.info()),t.value+=n);e.next()}t.value.length&&r.push(t);return r}function D(e){let t='',n;while(!e.end()){if((n=e.curr())=='{')break;else A.white_space(n)||(t+=n);e.next()}return t}function F(e){let t={name:'',arguments:[]},n;while(!e.end()){if((n=e.curr())=='(')e.next(),t.arguments=O(e);else if(/[){]/.test(n))break;else A.white_space(n)||(t.name+=n);e.next()}return t}function G(e){let t=M.psudo(),n;while(!e.end()){if((n=e.curr())=='}')break;if(A.white_space(n)){e.next();continue}else t.selector?t.styles.push(I(e)):(t.selector=D(e));e.next()}return t}function I(e){let t=M.rule(),n;while(!e.end()){if((n=e.curr())==';')break;else if(!t.property.length)t.property=B(e);else{t.value=R(e);break}e.next()}return t}function J(e){let t=M.cond(),n;while(!e.end()){if((n=e.curr())=='}')break;else if(!t.name.length)Object.assign(t,F(e));else if(n==':'){let n=G(e);n.selector&&t.styles.push(n)}else if(n=='@')t.styles.push(J(e));else if(!A.white_space(n)){let n=I(e);n.property&&t.styles.push(n)}e.next()}return t}function K(e){let t=W(e),n=[];while(!t.end()){let e=t.curr();if(A.white_space(e)){t.next();continue}else if(e=='/'&&t.curr(1)=='*')n.push(q(t));else if(e=='#'||e=='/'&&t.curr(1)=='/')n.push(q(t,{inline:!0}));else if(e==':'){let e=G(t);e.selector&&n.push(e)}else if(e=='@'){let e=J(t);e.name.length&&n.push(e)}else if(!A.white_space(e)){let e=I(t);e.property&&n.push(e)}t.next()}return n}function N(e,t){return L(K(e),t)}let Q=1,U=16;function V(e){let[t,n]=(e+'').replace(/\s+/g,'').replace(/[,ï¼ŒxX]+/,'x').split('x').map(Number),r={x:T(t||Q,1,U),y:T(n||t||Q,1,U)};return Object.assign({},r,{count:r.x*r.y})}let X="\n:host {\ndisplay: block;\nvisibility: visible;\nwidth: 1em;\nheight: 1em;\nwill-change: transform;\n}\n.container {\nposition: relative;\nwidth: 100%;\nheight: 100%;\n}\n.container:after {\ncontent: '';\ndisplay: block;\nclear: both;\nvisibility: hidden;\n}\n.cell {\nposition: relative;\nfloat: left;\nline-height: 0;\nbox-sizing: border-box;\n}\n.shape {\nbox-sizing: border-box;\nline-height: 0;\nposition: absolute;\nwidth: 100%;\nheight: 100%;\ntransform-origin: center center;\nz-index: 1;\ndisplay: flex;\nalign-items: center;\njustify-content: center;\n}\n";class Y extends HTMLElement{constructor(){super();this.doodle=this.attachShadow({mode:'open'})}connectedCallback(){setTimeout(()=>{if(!this.innerHTML.trim()){return!1}let e;try{e=N(this.innerHTML,this.size=V(this.getAttribute('grid')))}catch(e){this.innerHTML='';throw new Error(e)};let{has_transition:t}=e.props;this.doodle.innerHTML=`<style>${X}</style><style class="style-container">${this.style_size()}${e.styles.host}</style><style class="style-cells">${t?'':e.styles.cells}</style><div class="container">${this.html_cells()}</div>`;t&&setTimeout(()=>{this.set_style('.style-cells',e.styles.cells)},50)})}style_size(){return`.cell {width: ${100/this.size.x+'%'};height: ${100/this.size.y+'%'};}`}html_cells(){let e="\n<div class=\"cell\">\n<div class=\"shape\"></div>\n</div>\n";return e.repeat(this.size.count)}set_style(e,t){let n=this.shadowRoot.querySelector(e);n&&(n.styleSheet?(n.styleSheet.cssText=t):(n.innerHTML=t))}update(e){if(!e){return!1}this.size||(this.size=V(this.getAttribute('grid')));let t=N(e,this.size);this.set_style('.style-container',this.style_size()+t.styles.host);this.set_style('.style-cells',t.styles.cells);this.innerHTML=e}refresh(){this.update(this.innerHTML)}get grid(){return Object.assign({},this.size)}set grid(e){this.setAttribute('grid',e);this.connectedCallback()}static get observedAttributes(){return['grid']}attributeChangedCallback(e,t,n){e=='grid'&&t&&(t!==n&&(this.grid=n))}}customElements.define('css-doodle',Y)}))